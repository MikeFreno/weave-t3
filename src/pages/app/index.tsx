import React, { useContext, useEffect, useRef, useState } from "react";
import Navbar from "@/src/components/Navbar";
import Head from "next/head";
import ThemeContext from "@/src/components/ThemeContextProvider";
import SideNav from "@/src/components/app/SideNav";
import ServerModal from "@/src/components/app/ServerModal";
import useOnClickOutside from "@/src/components/ClickOutsideHook";

function index() {
  const { isDarkTheme } = useContext(ThemeContext);
  const [serverModalShowing, setServerModalShowing] = useState(false);
  const serverModalRef = useRef();
  const serverButtonRef = useRef();

  useOnClickOutside([serverModalRef, serverButtonRef], () =>
    setServerModalShowing(false)
  );

  useEffect(() => {
    if (serverModalShowing) {
      document.getElementById("app-body")?.classList.add("modal-open");
    } else {
      document.getElementById("app-body")?.classList.remove("modal-open");
    }
  }, [serverModalShowing]);

  function serverModalToggle() {
    setServerModalShowing(!serverModalShowing);
  }
  return (
    <div className="bg-zinc-700">
      <Head>
        <title> Web App | Weave</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Navbar />
      <div id="app-body" className="h-screen w-screen">
        <SideNav
          serverModalToggle={serverModalToggle}
          serverButtonRef={serverButtonRef}
        />
      </div>
      <div>
        {" "}
        {serverModalShowing ? (
          <ServerModal serverModalRef={serverModalRef} />
        ) : null}
      </div>
    </div>
  );
}

export default index;
